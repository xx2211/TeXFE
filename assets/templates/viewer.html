<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <style>
        body {
            margin: 0; padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: "Segoe UI", sans-serif;
            background-color: #ffffff;
            overflow: hidden;
        }

        /* 上半部分：渲染区 (预览) */
        #render-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            background-color: #fff;
            /* 点击渲染区也可以复制 */
            cursor: pointer;
        }

        /* MathJax 容器样式 */
        mjx-container {
            font-size: 250% !important;
            outline: none;
        }

        /* 下半部分：输入区 (类似 Excel/Overleaf) */
        #input-area {
            height: 80px; /* 固定高度 */
            padding: 10px;
            background-color: #f5f5f5;
            border-top: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }

        textarea {
            flex: 1;
            resize: none;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px;
            font-family: Consolas, monospace;
            font-size: 14px;
            outline: none;
        }
        textarea:focus { border-color: #0078d7; }

        /* 提示文字 */
        .hint {
            font-size: 10px; color: #999; margin-bottom: 4px;
            display: flex; justify-content: space-between;
        }
    </style>

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['\\[', '\\]']],
                packages: {'[+]': ['base', 'ams', 'noundefined']}
            },
            svg: { fontCache: 'global' },
            startup: { typeset: false } // 手动触发
        };
    </script>
    <script src="mathjax.js"></script>
</head>
<body>

    <div id="render-container" title="点击复制">
        <div id="math-output"></div>
    </div>

    <div id="input-area">
        <div class="hint">
            <span>LaTeX 源码编辑</span>
            <span>MathJax 渲染模式</span>
        </div>
        <textarea id="latex-input" spellcheck="false"></textarea>
    </div>

    <script>
        const inputEl = document.getElementById('latex-input');
        const outputEl = document.getElementById('math-output');
        const renderBox = document.getElementById('render-container');

        // 渲染逻辑
        function render() {
            const latex = inputEl.value;
            // 方案 B：使用 \[ ... \] 包裹，保留 textstyle
            outputEl.innerHTML = '\\[' + latex + '\\]';

            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise([outputEl]).catch((err) => console.log(err));
            }
        }

        // 监听输入
        inputEl.addEventListener('input', () => {
            render();
            // 通知 Python 内容变了 (为了切换模式时数据不丢)
            document.title = "LATEX:" + inputEl.value;
        });

        // Python 调用的接口
        function setContent(latex) {
            inputEl.value = latex;
            render();
        }

        function getContent() {
            return inputEl.value;
        }

        // 点击预览区复制
        renderBox.addEventListener('click', () => {
            document.title = "CMD:COPY:" + new Date().getTime() + ":" + inputEl.value;
        });
    </script>
</body>
</html>